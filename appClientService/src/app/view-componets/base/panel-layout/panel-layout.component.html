<mat-card>
    <mat-tab-group mat-align-tabs="start">
        <mat-tab label="Subir Archivo">
            <app-add-csv>
            </app-add-csv>
        </mat-tab>
        <mat-tab label="Distribuir actividades">
            <app-actividades-tecnico>
            </app-actividades-tecnico>
        </mat-tab>
        <mat-tab label="Consultas">
          <br>
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-center">
                  <h5 class="">Consultas sobre actividades</h5>
              </div>
              <br>
              <mat-accordion>
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    Expandir para consultar
                  </mat-expansion-panel-header>
                  <div class="row">
                    <div class="col col-3">
                        <div class="input-formulario">
                          <mat-form-field>
                            <input matInput #pickerInput [matDatepicker]="picker" 
                            placeholder="Elija la fecha" [formControl]="date" 
                            (dateChange)="getFecha(pickerInput.value)">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                          </mat-form-field>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="input-formulario">
                            <mat-form-field>
                                <mat-select matNativeControl placeholder="Técnico" 
                                name="tecnico" id="tecnico"  [(ngModel)]="tecnicoBuscar"> 
                                    <mat-option value="empty">Técnico</mat-option>
                                    <mat-option *ngFor="let tecnico of tecnicos | async" value="{{tecnico.id_tecn}}">{{tecnico.apellidos}} {{tecnico.nombres}}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="input-formulario">
                            <mat-form-field>
                                <mat-select matNativeControl placeholder="Actitividad" 
                                name="actividad" id="actividad" [(ngModel)]="actividadBuscar"> 
                                    <mat-option value="empty">Actividad</mat-option>
                                    <mat-option value="10">Notificación</mat-option>
                                    <mat-option value="30">Cortes</mat-option>
                                    <mat-option value="40">Reconexión</mat-option>
                                    <mat-option value="50">Retiro</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="input-formulario">
                            <mat-form-field>
                                <mat-select matNativeControl placeholder="Estado" 
                                name="estado" id="estado" [(ngModel)]="estadoBuscar"> 
                                    <mat-option value="empty">Estado</mat-option>
                                    <mat-option value="1" >Asignado</mat-option>
                                    <mat-option value="0" >Sin Asignar</mat-option>
                                    <mat-option value="2" >Terminadas</mat-option>
                                    <mat-option value="3" >No Terminadas</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                  </div>
                  <div class="row">
                    <button class="btn btn-primary btn-sm" style="margin-right: 10px;" (click)="verActividaes()">Ver Actividades</button>
                    <button class="btn btn-warning btn-sm" style="margin-right: 10px;" (click)="verRecManual()">Ver Rec-Manuales</button>
                    <button class="btn btn-sm btn-success" (click)="exportarExcelActividades()" style="margin-right: 10px;" >Exportar a Excel</button>
                  </div>
                </mat-expansion-panel>
              </mat-accordion>
            </div>
          </div>
          <br>
          
          <div class="card" >
            <div class="card-body">
              <div class="d-flex justify-content-center">
                  <h5 class="">Actividades buscadas</h5>
              </div>
              <div *ngIf="view_table">
                <mat-grid-list cols="2" rowHeight="1:0.2">
                    <mat-grid-tile>
                      Datos de las órdenes de trabajo:
                    </mat-grid-tile>
                    <mat-grid-tile>
                        <mat-form-field class="col-lg-6 col-md-6 col-sm-6">
                            <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Buscar">
                        </mat-form-field>
                    </mat-grid-tile>
                </mat-grid-list>
                <div class="table-responsive">
                    <table mat-table [dataSource]="dataSource" class="table table-sm table-striped ">
                        <!-- Id Column -->
                        <ng-container matColumnDef="index">
                          <th mat-header-cell *matHeaderCellDef> N° </th>
                          <td mat-cell *matCellDef="let i=index"> {{i+1}} </td>
                        </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="tecnico">
                            <th mat-header-cell *matHeaderCellDef> Teénico </th>
                            <td mat-cell *matCellDef="let tarea"> 
                              <div style="width: 150px;">
                                  {{tarea.nombres}} {{tarea.apellidos}} 
                              </div>
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="actividad">
                          <th mat-header-cell *matHeaderCellDef> Actividad </th>
                          <td mat-cell *matCellDef="let tarea"> 
                              {{tarea.n9cono}} 
                          </td>
                        </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="cuenta">
                            <th mat-header-cell *matHeaderCellDef> Cuenta </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.n9cocu}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="canton">
                            <th mat-header-cell *matHeaderCellDef> Cantón </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.n9coag}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="sector">
                            <th mat-header-cell *matHeaderCellDef> Sector </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.n9cose}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="medidor">
                            <th mat-header-cell *matHeaderCellDef> Medidor </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.n9meco}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="lectura">
                            <th mat-header-cell *matHeaderCellDef> Lectura </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.n9leco}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="usuario">
                            <th mat-header-cell *matHeaderCellDef> Usuario </th>
                            <td mat-cell *matCellDef="let tarea">
                              <div style="width: 200px;">
                                  {{tarea.n9nomb}}
                              </div> 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="latitud">
                            <th mat-header-cell *matHeaderCellDef> Latitud </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.cucoon}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="longitud">
                            <th mat-header-cell *matHeaderCellDef> Longitud </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.cucooe}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="hora">
                            <th mat-header-cell *matHeaderCellDef> Hora </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.hora}} 
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="novedad">
                            <th mat-header-cell *matHeaderCellDef> Observación </th>
                            <td mat-cell *matCellDef="let tarea">
                              <div style="width: 150px;">
                                  {{tarea.observacionFin}}
                              </div>
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="estadoAct">
                            <th mat-header-cell *matHeaderCellDef> Estado </th>
                            <td mat-cell *matCellDef="let tarea"> 
                              
                            </td>
                          </ng-container>
                        <!-- Nombres Column -->
                        <ng-container matColumnDef="estadoFinal">
                            <th mat-header-cell *matHeaderCellDef> Estado </th>
                            <td mat-cell *matCellDef="let tarea"> 
                                {{tarea.referencia}} 
                            </td>
                          </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
                </div>
              </div>
              <div *ngIf="view_data_empty" class="alert alert-danger" style="text-align: center;">
                No hay datos para mostrar
              </div>

              <!--datos de reconexiones manuales-->
              <app-table-recmanual></app-table-recmanual>

            </div>
          </div>
          
          
        </mat-tab>
        <mat-tab label="Consolidado">
              <!--
                <ngx-spinner
                bdColor="rgba(51,51,51,0.8)"
                size="large"
                color="#fff"
                type="ball-clip-rotate-multiple">
              </ngx-spinner>
              -->
              <div class="card-body">
                  <div class="d-flex justify-content-center">
                      <h4 class="">Generar consolidado</h4>
                  </div>
                  <br>
                  <div class="card">
                    <div class="card-body">
                      <!--
                      <div class="accordion" id="accordionExample">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                              <a style="text-align: center;" class="nav-link" data-toggle="collapse" data-target="#collapse3" href="#" aria-expanded="true" aria-controls="collapse3">
                                  Necesitas ayuda? Presiona AQUÍ
                              </a>
                            </div>
  
                            <div id="collapse3" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                              <div class="card-body">
                                <p>Para generar el consolidado, realice los siguientes pasos:</p>
                                <p>1.- Ingrese la fecha del consolidado que desea generar</p>
                                <p>2.- Presione el botón <strong>"Consolidar Actividades"</strong></p>
                                <p>3.- Para obtener el consolidado oprima el botón <strong>"Descargar consolidado"</strong></p>
                              </div>
                            </div>
                          </div>
                      </div>
                      -->
                      <br>
  
                      <div class="row">
                        <div class="col col-lg-1">
                          <label for="">Fecha:</label>
                        </div>
                          <div class="col col-lg-3 d-flex justify-content-center form-group">         
                              <input  class="form-control" id="fecha" name="fecha" type="date">   
                          </div>
                      </div>
                      <div class="row">
                        <div class="col d-flex justify-content-center form-group">
                          <button class="btn btn-success"  (click)="consolodarActividades();">Consolidar </button>  
                        </div>
                      </div>
                      <div class="row">
                          
                          <!--<div class="col d-flex justify-content-center form-group">
                            <button *ngIf="exportable" class="btn btn-warning" (click)="exportarConsolidado();">Descargar consolidado </button>  
                          </div>-->
                          <div class="col d-flex justify-content-center form-group">
                              <a *ngIf="exportable"  class="btn btn-warning"  href="{{url_export}}/{{fecha_consolidado}}/{{id_emp}}" download="consolidado">
                              Descargar
                              </a> 
                          </div>
  
                      </div>
                      <div class="row">
                        <div class="col loading d-flex justify-content-center" *ngIf="loading">
                            <img src="assets/img/cargando.gif">
                        </div>    
                      </div>
                    </div>
                  </div>
              </div>
        </mat-tab>
    </mat-tab-group>
</mat-card>